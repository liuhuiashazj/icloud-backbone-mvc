define("text!views/iboxleft/left.css",[],function(){return"#iboxlist .op1{margin-top:10px;}#sharetome{margin-left:20px;font-size:15px;line-height:40px;cursor:pointer;}#sharetome:hover{color:#63a2ef;}.treepop:after{left:20px;}#treeleft .jstree-anchor{width:130px;}#treeleft .jstree-input{width:83px;}#treeleft .jstree-item > .jstree-witem > .share{background-position:-120px 8px;display:inline-block !important;}#treeleft .jstree-item > .jstree-witem > .share:hover,#tree .jstree-item > .jstree-item-on > .share,#treeleft .jstree-item-active > .jstree-witem .share{background-position:-120px -20px !important;}#treeleft .jstree-item > .jstree-witem > .person{background-position:-154px 8px;}#treeleft .jstree-item > .jstree-witem > .person:hover,#tree .jstree-item > .jstree-item-on > .person ,#treeleft .jstree-item-active > .jstree-witem .person{background-position:-154px -20px !important;}#treeleft .jstree-item-on > .jstree-wname .jstree-anchor{color:inherit;}#treeleft .jstree-item-on > .jstree-wname .jstree-anchor:hover{color:#63a2ef;}#treeleft .jstree-item-active > .jstree-witem .jstree-anchor{color:#63a2ef;}#tree .jstree-item > .jstree-item-on > .jstree-icon,#tree .jstree-item-active.jstree-item > .jstree-witem .jstree-icon{background-position:-60px -23px;}#tree .jstree-close > .jstree-item-on > .jstree-icon,#tree .jstree-item-active.jstree-close > .jstree-witem .jstree-icon{background-position:1px -23px;}#tree .jstree-open > .jstree-item-on > .jstree-icon,#tree .jstree-item-active.jstree-open > .jstree-witem .jstree-icon{background-position:-30px -23px;}"}),define("views/iboxleft/iboxleft",["text!views/iboxleft/left.css"],function(e){var t=Backbone.BaseView.extend({el:"#treeleft",cssText:e,url:$.urlMap.turl,events:{"mouseenter .jstree-anchor":"evtDragenter","mouseleave .jstree-anchor":"evtDragout"},treeTpl:'<span class="jstree-whole"></span><div class="jstree-witem " ><i class="jstree-icon <%if(this.type=="2"&&this.fid=="-1"){%>share<%}else if(this.type=="2"){%>person<%}else{%>file<%}%>"></i><div class="jstree-wname" ><%if(!this.isInput){%><span class="jstree-anchor" data-menu="<%this.allowmenu?1:0%>"  <%if(!(this.text.length < 10)){%>data-tips="<%this.text%>" <%}%> data-fid="<%this.fid%>"  <%if(this.type=="1"&&this.depth!=1){%>draggable="true"<%}%> data-drop="<%if(this.type=="1"){%>1<%}%>"><%this.text%></span><%}else{%><input class="jstree-input"  type="text" value="<%this.text%>"/><span class="jstree-cancel"></span><%}%></div></div>',reloadTree:function(e){var t=this;if(!t.tree||t.options.route!="ibox")return;t.tree.updateTree({getData:this.getTreeData(e)})},getTreeData:function(e){var t=this;return function(e){return function(){var n=e||t.options.fid,r=$.Deferred();return $.get($.urlMap.turl,{source:"person",vfid:n,_:(new Date).getTime()},function(e){if(parseInt(e.errno))return;r.resolve(e.result)}),r.promise()}}(e)},init:function(e){var t=this;Backbone.Events.on("UpdateTree",function(e){t.reloadTree(e)}),Backbone.Events.on("UpdateCur",function(e){t.setDomAsCurrent(e)}),Backbone.Events.on("dragfile",function(e){t.dragFromOut=1,t.outDragFid=e}),Backbone.Events.on("dragfileend",function(){t.dragFromOut=0}),$("body").on("mouseup",function(e){t.evtDrop(e)}),this.$el.on("mousewheel",function(e){$(".jstree-menu").hide()}),this.extendInit.call(this,e),$.fn.poptips({parent:"body",selector:".jstree-anchor",top:10,left:10,cls:"treepop",width:"auto"})},extendInit:function(){},setDomAsCurrent:function(e){var t,n,r;e=e!=undefined?e:this.fid,e=e=="share"?"-1":e,n=this.$el.find('[data-fid="'+e+'"]');if(!n.length)return;r=$.ldom.getParentByTag(n[0],"li"),t=$(r).offset().top,this.$el.find(".jstree-item-active").removeClass("jstree-item-active"),this.$el[0].scrollTop=t-100,this.tree.$activeItem=$(r),$(r).addClass("jstree-item-active"),this.$el.find(".wrap-tree").css({opacity:1})},getMenuConfig:function(){var e=this,t={insertBefore:1,dbclicktime:200,dropParent:"#wrapall",reqOnAdd:function(e,t){var n=$.Deferred(),r;return r=$.urlMap.addurl,$.post(r,{dirname:t,source:"person",parentid:e,sid:0},function(e){n.resolve(e)}),n.promise()},reqOnRemove:function(e){var t=$.Deferred(),n;return n=$.urlMap.removeurl,$.post(n,{fids:e},function(e){t.resolve()}),t.promise()},reqOnRename:function(e,t){var n=$.Deferred(),r;return r=$.urlMap.seturl,$.post(r,{fid:e,name:t},function(e){n.resolve(e)}),n.promise()}};return t},initTree:function(){var e=this,t,n;n=this.getMenuConfig(),t=this.fid;if(this.hasInit)return;this.hasInit=1,this.tree=$.BaseTree2.getExample({parentId:"tree",getData:function(e){e==0&&(e=t);var n=$.Deferred();return $.get($.urlMap.turl,{source:"person",vfid:e,_:(new Date).getTime()},function(e){if(parseInt(e.errno))return;n.resolve(e.result)}),n.promise()},getCData:function(e){var t=$.Deferred();return e=e||0,$.get($.urlMap.turl,{source:"person",fid:e,_:(new Date).getTime()},function(e){if(parseInt(e.errno))return;t.resolve(e.result)}),t.promise()},litpl:e.treeTpl,alias:function(e){var t={id:"fid",text:"dirname",hasChild:"havechild",child:"child",allowmenu:"allowmenu"};return t[e]||e},open:!0,plugins:[{type:"menu2",options:n},{type:"dnd2",options:{insertBefore:1,reqOnMove:function(e,t){var n=$.Deferred(),r;return r=$.urlMap.moveurl,$.post(r,{dest_fid:t,source_fids:e},function(e){n.resolve()}),n.promise()}}}],callbacks:{onClick:function(t){var n=t.target.getAttribute("data-fid"),r={};r.fid=n;if(n==-2)return;n=="-1"&&(r.fid="share"),e.goIboxPage(r)},onBuildTree:function(){e.setDomAsCurrent()},onDuplicatNameOnRename:function(e){$.fn.tips("不能重名")},onDuplicatNameOnMove:function(e){$.fn.tips("移动失败,该目录下已经有同名文件夹")},onMoveToChildError:function(e){$.fn.tips("移动失败,不能移动到子节点")},onDeleteChild:function(t){var n=t.fid;e.goIboxPage({fid:n}),e.setDomAsCurrent(n),$.fn.tips("删除成功",1)}}})},display:function(e){var t=this,n=e.fid||0;this.fid=n,this.options=e;if(n==this.lastFid)return;this.lastFid=n,this.initTree()},evtDrop:function(e){e=e.originalEvent;var t=this.outDragFid,n=$(e.target),r,i;if(!this.dragFromOut||!t)return;if(!n.hasClass("jstree-anchor")){this.dragFromOut=0;return}r=e.target.getAttribute("data-fid"),i=e.target.getAttribute("data-menu")-0;var s=$(e.target).attr("data-drop")-0;if(!i&&!s)return;$.ajax({data:{dest_fid:r,source_fids:t},url:$.urlMap.moveurl,type:"get",dataType:"json",success:function(e){if(e.errno){$.fn.tips(e.errmsg);return}Backbone.Events.trigger("movesuccess",{did:r,fid:t}),$.fn.tips("移动成功",1)}}),this.dragFromOut=0},evtDragenter:function(e){var t,n,r;e=e.originalEvent;if(!this.dragFromOut)return;r=$(e.target);var i=$(e.target).attr("data-menu")-0,s=$(e.target).attr("data-drop")-0;if(!i&&!s){r.css("cursor","no-drop");return}t=$($.ldom.getParentByTag(e.target,"li")),$(e.target).addClass("dragenter"),this.tree.showFold(t)},evtDragout:function(e){var t=$(e.target);t.css("cursor","pointer"),e=e.originalEvent,$(e.target).removeClass("dragenter")}});return t});