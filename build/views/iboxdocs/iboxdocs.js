define("text!views/doclist/doclistall.tpl",[],function(){return'\n<div class="wtablist ">\n    <%if(route==\'ibox\'||route==\'team\'){%>\n\n    <div class="op8"></div>\n    <%}%>\n    <div class="wrapop1">\n        <div class="op1">\n            <%if(route!=\'newmeet\'&&route!=\'search\'){%>\n            <%if(route==\'editmeet\'&&copy==\'1\'){%>\n                <span\n                class="tit">会议文档</span><span\n                class="upload" id="fileupload">上传</span><span\n                class="del">删除</span>\n            <%}else{%>\n            <%if(route!=\'ibox\'&&route!=\'team\'){%><span\n                class="tit">会议文档</span><%}%><span\n                class="newdir able">新建文件夹</span><span\n                class="upload" id="fileupload">上传</span><span\n                class="down">下载</span><span\n                class="rename">重命名</span><span\n                class="del">删除</span><%if(route!=\'ibox\'&&route!=\'team\'){%><span\n                class="addsum able">创建会议纪要</span><%}%>\n            <%}}else if(route==\'search\'){%>\n            <span\n                class="down">下载</span><span\n                class="rename">重命名</span><span\n                class="del">删除</span>\n            <%}else{%>\n            <span\n                class="tit">会议文档</span><span\n                class="upload" id="fileupload">上传</span><span\n                class="del">删除</span>\n            <%}%>\n        </div>\n    </div>\n        <%if(route==\'newmeet\'){%>\n        <div class="uptips">每次最多10个文件，单个文件最大100m</div>\n        <%}%>\n\n        <div class="op7">\n\n        </div>\n        <div class="wrapdoclist">\n\n            <div class="doclistinner">\n\n            </div>\n\n            <div  id="pastewrap<%if(route==\'team\'||route==\'ibox\'){%><%=route%><%}%>" >松开鼠标开始上传</div>\n\n        </div>\n</div>'}),define("text!views/doclist/doclist.css",[],function(){return".wrapdoclist{margin-bottom:30px;}#doclist .jsdropdown-lists{max-height:inherit;}"}),define("text!views/doclist/author.tpl",[],function(){return'<div class="member">\n    <div class="nav"><span class="tit">共享权限</span><span class="close"></span></div>\n    <div class="asearch">\n        <div class="winput"><input class="sauthor" placeholder="+搜索添加百度员工、邮件组"/></div>\n    </div>\n    <div class="thead">\n        <span class="t1">成员</span>\n        <span class="t2">共享权限</span>\n    </div>\n    <div class="wrapmem">\n        <table border="0" cellpadding="0" cellspacing="0" class="items ">\n        </table>\n    </div>\n    <div class="haslist">\n        <div class="head">已共享 <span class="fold"></span></div>\n        <div class="wtable">\n            <table border="0" cellpadding="0" cellspacing="0" class="items ">\n            </table>\n        </div>\n    </div>\n    <div class="op4">\n        <span class="t1">通知新增权限成员</span><input autocomplete="off" class="bluebox" type="checkbox" name="is_email2"\n                                               id="email2">邮件<input\n            autocomplete="off" class="bluebox" type="checkbox" name="is_hi" id="hi">hi消息<span class="stop" id="stop">停止共享</span>\n        <div id="ok" class="bbutton">确定</div>\n    </div>\n</div>'}),define("text!views/doclist/authorlist.tpl",[],function(){return'\n<%for(var i=0,l=result.length;i<l;i++){ var per=result[i];var au=per.chmod.split(\'\')%>\n<tr data-mail="<%=per.email%>" data-rtype="<%=per.rtype%>" data-chmod="<%=per.chmod%>">\n<td class="t1"><span><%=per.realname||per.name%><%if(per.depart){%>(<%=per.depart%>)<%}%></span></br><span><%=per.email%></span></td>\n<td class="t2 <%if(!per.isadmin){%>wrapop5<%}%>"><%if(!per.isadmin){%><span class="op5" > <%if(au[0]==1){%>查看<%}%><%if(au[1]==1){%>&nbsp;下载<%}%><%if(au[2]==1){%>&nbsp;编辑<%}%><%if(per.chmod==\'000\'){%>不可见<%}%></span><%}else{%>管理<%}%></td>\n</tr>\n<%}%>\n'}),define("text!views/doclist/newtd.tpl",[],function(){return'<%if(status){%>\n    <%if(progressNum){%><span>上传中:<%=progressNum%></span><%}%>\n    <%if(successNum){%><span>成功:<%=successNum%></span><%}%>\n    <%if(uploadFailNum){%><span class="colfail">失败:<%=uploadFailNum%></span><%}%>\n    <%if(interruptNum){%><span class="colfail">终止:<%=interruptNum%></span><%}%>\n<%}else{%>\n<%for(var i=0,l=docs.length;i<l;i++){var doc=docs[i];%>\n    <div class="item" id="<%=doc.id%>">\n    <span class="icon t1 <%=doc.ext%>"></span><span class="t2"><%=doc.name%></span><span class="t3">\n        <%if(doc.size<1024){%>\n            <%=doc.size%>B\n        <%}else if(doc.size<1024*1024){%>\n            <%=(doc.size/(1024)).toFixed(1)%>K\n        <%}else{%>\n            <%=(doc.size/(1024*1024)).toFixed(2)%>M\n        <%}%>\n    </span><span\n        class="status t4"></span><span data-status="pending" class="delfile t5">删除</span><span class="progress t7"></span>\n    </div>\n<%}%>\n<%}%>\n'}),define("views/doclist/doclist",["text!views/doclist/doclistall.tpl","text!views/doclist/doclist.css","text!common/tpl/doclist.tpl","text!common/tpl/upload.tpl","text!views/doclist/author.tpl","text!views/doclist/authorlist.tpl","text!views/doclist/newtd.tpl","text!common/tpl/confirm.tpl","text!common/tpl/preview.tpl"],function(e,t,n,r,i,s,o,u,a){var f=Backbone.BaseView.extend({el:"#doclist",cssText:t,authorurl:$.urlMap.setRule,pasteId:"#pastewrap",template:_.template(e),detailstpl:_.template(n),uptpl:_.template(r),authortpl:_.template(i),atabtpl:_.template(s),tdtpl:_.template(o),stoptpl:_.template(u),previewtpl:_.template(a),dirtpl:_.template('<span class="all dirs" >全部文件</span><%for(var i =0,l=tree.length;i<l;i++){%>&gt;<span class="<%if(i!=l-1){%>dirs<%}%>" data-id="<%=tree[i].fid%>"><%=tree[i].filename%></span><%}%>'),events:$.extend({"keydown .fname input":"enterFname","click .fname input":"stopDefault","blur .fname input":"blurName","click .fname":"clickFname","click .crename":"clickCancelRename","click .selectall":"selectall","click .selectone":"selectone","click .op1>span":"clickop1","click .op2>span":"clickop2","click .category a":"switchToDetail","click .meeting":"goMeeting","click .author":"openAuthorDrop","click .dirs":"getDir"},Backbone.BaseView.baseEvents),drop:{},modal:{},files:{},options:{},rn:20,rightOps:{down:{name:"下载",value:"down"},del:{name:"删除",value:"del"},edit:{name:"编辑",value:"edit"},rename:{name:"重命名",value:"rename"},share:{name:"转发到hi",value:"share"},authoring:{name:"共享",value:"authoring"},email:{name:"发送电子邮件",value:"email"},hi:{name:"发送Hi提醒",value:"hi"}},stopshareurl:$.urlMap.stopShare,upModalId:"#wrapup",init:function(){var e=this;this.date=$.fn.getCurDate(),this.authorId="wrapauthor",this.on("updateData",function(t){for(var n in t)e.options[n]=t[n]}),this.on("insertDoclist",function(t){e.$paste=e.$el.find(e.pasteId),e.options.mid=t.mid,e.showDocList(),e.$el.show(),e.initUploader()}),this.initPoptips(),this.initExtend()},initRightDropDown:function(){if(this.initRightFlag)return;this.initRightFlag=1;var e=this,t;t={el:".fname",parent:e.el,leftOffset:10,topOffset:10,useClickCoord:1,cls:"rdropdown",tpl:'<%for(var i=0;i<this.lists.length;i++){ list=this.lists[i];%><li data-value="<%list.value%>" ><%list.name%></li><%}%>',getData:function(t){var n,r,i,s,o,u,a,f,l,c,h,p=[],d=t.currentTarget,v=$.Deferred();return o=e.rightOps,n=$(d).parents("tr"),r=n.attr("data-down")&&p.push(o.down),i=n.attr("data-edit")&&p.push(o.edit),l=n.attr("data-del")&&p.push(o.rename),f=n.attr("data-del")&&p.push(o.del),e.options.route=="ibox"&&!e.fromShare&&p.push(o.authoring),s=!n.attr("data-isdir")&&e.options.route=="ibox",s&&p.push(o.share),u=!n.attr("data-isdir")&&e.options.route.match(/detail/),c=u&&p.push(o.email),h=u&&p.push(o.hi),this.lists=p,v.resolve(),v.promise()},tplSpan:'<span class="op5"><%=name%></span>',selectCallback:function(t){var n=this.$obj,r,i={},s,o=t.attr("data-value");r=n.parents("tr"),s=n[0],i.currentTarget=s,e.handleOps(o,i,n)}},this.rightDropdown=$.RightDropDown.getExample(t)},handleOps:function(e,t,n){var r=this;switch(e){case"down":r.downfile(t);break;case"del":r.delfile(t);break;case"rename":r.editname(n);break;case"edit":r.goEditFile(t);break;case"share":r.shareDoc&&r.shareDoc(n);break;case"email":r.confirmBeforeEmail(t);break;case"hi":r.confirmBeforeEmail(t,1);break;case"authoring":r.hideAuthor&&r.hideAuthor(),r.openAuthor(t);break;default:}},initPoptips:function(){var e=this,t=e.popParent||".listLeft";if(this.initPoptipsFlag)return;this.initPoptipsFlag=1,$.fn.poptips({parent:t,selector:".op2>span",left:-24,top:-2,width:55})},initDrag:function(){var e=this;if(this.initDragFlag)return;this.initDragFlag=1,$("body").on("dragenter",function(t){if(!e.isShowing)return;t=t.originalEvent;var n=$.lutils.containsFiles(t);if(!n)return;var r=e.$paste,i=e.mData+e.mDir,s="top"+i;r.removeClass().addClass(s).show()}),$("body").on("mouseleave",function(){e.$paste&&e.$paste.hide()})},initExtend:function(){var e=this;window.meetDocClose=function(){e.showDocList()}},switchToDetail:function(e){e.preventDefault();var t,n,r,i,s,o,u=$.ldom.getParentByTag(e.target,".category");t=$(u),n=t.attr("data-from"),r=t.attr("data-mid"),i=t.attr("data-name"),s=t.attr("data-pid"),n==1?o="#detail/detailm/all/"+r:n==2?(o="#ibox/"+s,Backbone.Events.trigger("UpdateTree",s)):(o="#ibox/"+i,Backbone.Events.trigger("UpdateTree",i)),Backbone.history.navigate(o,{trigger:!0})},addSum:function(){var e=this.docurl;e&&window.open(e)},destory:function(){window.hasInputFocus=0,this.$el.html("").hide()},beforeDisplay:function(e){var t=this;this.options=$.extend(self.options,e),this.source=e.route=="ibox"?"person":e.route=="team"?"team":"meeting"},display:function(e){var t=this;this.currentPage=1;var n=t.template(e);t.$el.html(n).hide(),t.initModal(),t.initDropDown(),this.options.route!="search"&&t.initDrag();if(e.route=="editmeet"&&e.copy==1||e.route=="newmeet")return;e.route=="search"&&(t.$el.show(),t.showSearchList())},loadMore:function(){var e=this;if(!this.hasMore)return;this.currentPage++,this.options.route=="search"&&this.showSearchList(1)},showSearchList:function(e){var t=this.options,n=this;$.ajax({url:$.urlMap.searchFile,dataType:"json",type:"GET",cache:!1,data:{kw:t.word,page:n.currentPage,pageSize:n.rn},success:function(r){if(r.errno)return;var i;r=r.result,i=$.extend({},t),n.hasMore=r.has_more,i.has_more=r.has_more,i.docs=r.files,i.totalPn=100,i.isSearch=1,i.docs.length==0&&n.$el.find(".wtablist .op1").hide();if(!e){i.showWrap=1,i.showLoad=1;var s=n.detailstpl({data:i});n.$el.find(".doclistinner").html(s),!n.hasMore&&n.showNoMore(1)}else{i.showLoad=0,i.showWrap=0;var s=n.detailstpl({data:i});$(".doclistinner table tbody").append(s),!n.hasMore&&n.showNoMore(0)}}})},getDir:function(e){var t=$(e.currentTarget).attr("data-id")||"";this.showDocList(t)},showDocList:function(e){var t=this,n=this.options;e=e||"",window.hasInputFocus=0,t.options.parentid=e,$.ajax({url:$.urlMap.meetDocs,data:{mid:n.mid,pn:t.currentPage,pageSize:t.rn,fid:e},cache:!1,dataType:"json",success:function(n){if(n.errno){$.fn.tips(n.errmsg);return}n=n.result,n.showWrap=1,n.showLoad=0,t.docurl=n.docurl,n.route=t.options.route;var r=t.detailstpl({data:n});t.$el.find(".doclistinner").html(r),n.mid=t.options.mid,t.mData=n.docs.length?1:0,t.mDir=e?2:0;if(!e)t.$el.find(".op7").hide();else{var i=t.dirtpl(n);t.$el.find(".op7").html(i).show()}t.checkOp1(),t.initRightDropDown()}})},initUploader:function(){var e=this;e.uploader=window.WebUploader.create({pick:{id:"#fileupload"},swf:"common/imgs/Uploader.swf",runtimeOrder:"html5,flash",sendAsBinary:!1,fileNumLimit:10,dnd:e.pasteId,paste:".wtablist",disableGlobalDnd:!0,formData:{source:e.source,sid:e.options.mid||"",is_himsg:0,is_mail:0},server:$.urlMap.upFile,fileSizeLimit:524288e4,fileSingleSizeLimit:1048576e3}).on("fileQueued",function(t){this.options.formData.sid=e.options.mid,this.options.formData.parentid=e.options.parentid,e.files[t.id]=t,e.$paste.hide(),t.on("statuschange",function(n,r){n=="complete"&&e.setOk(t),n=="progress"&&e.setInit(t),(n=="interrupt"||n=="error")&&e.setFail(t)})}).on("error",function(t,n){t=="Q_TYPE_DENIED"&&e.$paste.hide()}).on("filesQueued",function(t){e.showModal("upload"),e.fileNum=t.length,e.setStatusDefault(),$(e.upModalId+" .files").html(e.tdtpl({docs:t,status:0})),$(e.upModalId+" .start").attr("data-status","pending").html("开始").removeClass("close2")}).on("uploadProgress",function(t,n){e.setPer(t,n)}).on("all",function(t){var n=this.getStats();e.setStatus(n)}).on("uploadSuccess",function(t,n){if(n.errno){$.fn.tips(n.errmsg),e.setFail(t);return}e.setOk(t)})},setStatus:function(e){var t=this,n=e.successNum+e.uploadFailNum;if(e.progressNum||e.successNum||e.uploadFailNum||e.interruptNum){var r=$.extend({},e);r.status=1;var i=this.tdtpl(r);$(t.upModalId+" .sts").html(i)}this.fileNum==n&&$(t.upModalId+" .start").attr("data-status","pending").html("完成").addClass("close2")},startall:function(e){var t=this,n=$(e.currentTarget),r=n.attr("data-status");r=="pending"?(this.uploader.upload(),n.attr("data-status","uploading").html("全部终止")):r=="uploading"?(this.uploader.stop(!0),n.attr("data-status","pending").html("重新上传")):r=="interrupt"&&(this.uploader.stop(!0),this.uploader.upload(),n.attr("data-status","uploading").html("全部终止"))},retryuploader:function(e){var t=$(e.currentTarget).parents("span").attr("data-id"),n=this.files[t];this.uploader.upload(n)},removeFile:function(e){var t=this,n=$(e.currentTarget),r=n.parents(".item"),i=r.attr("id"),s=n.attr("data-status");if(s=="uploading"){var o=this.files[i];this.setFail(o),$(t.upModalId+" .start").attr("data-status","interrupt").html("继续上传"),this.uploader.stop(o)}else if(s=="pending"||s=="fail"){var r=$("#"+i);r.remove(),this.fileNum--,this.setStatusDefault(),this.uploader.removeFile(i),this.fileNum==0&&this.hideModal("upload")}return},setStatusDefault:function(){var e=this;$(e.upModalId+" .sts").html("上传"+this.fileNum+"个文件到云平台！")},resetUpload:function(){$(self.upModalId+" .files").html(""),this.uploader.reset(),this.showDocList(this.options.parentid)},insertDocs:function(e){var t=this.options.route,n=this.$el.find(".doclistinner table"),r=n.length==0?1:0,i=this.detailstpl({data:{showWrap:r,showLoad:0,total:e.length,docs:e,route:t}});r?(this.$el.find(".nolist2").hide(),this.$el.find(".doclistinner").append(i)):n.find("tr:first-child").after(i);return},setInit:function(e){var t=$("#"+e.id+" .progress"),n=t[0];t.parent().removeClass("fail").removeClass("ok"),t.parent().find(".status").html("").attr("data-id",e.id),t.parent().find(".delfile").html("删除").attr("data-status","pending"),n.style.width="0"},setOk:function(e){var t=$("#"+e.id+" .progress"),n=t[0];t.parent().removeClass("fail").addClass("ok"),t.parent().find(".status").html("").attr("data-id",e.id),t.parent().find(".delfile").html("").attr("data-status","success"),t.stop(!0),n.style.width="0"},setFail:function(e){var t=$("#"+e.id+" .progress"),n=t[0];t.parent().removeClass("ok").addClass("fail"),t.parent().find(".status").html('<i class="retry">重试</i>').attr("data-id",e.id),t.parent().find(".delfile").html("删除").attr("data-status","fail"),t.stop(!0),n.style.width="0"},setPer:function(e,t){var n=$("#"+e.id+" .progress");$("#"+e.id+" .delfile").html("终止").attr("data-status","uploading"),n.animate({width:t*100+"%"})},stopShare:function(e){var t=this,n=this.stopshareurl;$.ajax({cache:!1,url:n,data:{source:t.source,fid:t.options.fid,sid:t.options.mid},type:"POST",dataType:"json",success:function(e){e.errno?$.fn.tips(e.errmsg):$.fn.tips("停止共享设置成功！",1),t.showDocList(t.options.parentid),t.hideModal("author"),t.hideModal("stopshare")}})},openAuthorDrop:function(e){this.showAuthor&&this.showAuthor(),this.openAuthor(e)},openAuthor:function(e){var t=this;e.stopPropagation(),e=e||{};var n=$(e.currentTarget).parents("tr"),r=n.attr("data-fid"),i=this.options;i.fid=r,$.ajax({cache:!1,url:$.urlMap.getFileRule,data:{fid:r,sid:t.options.mid,source:t.source},type:"POST",dataType:"json",success:function(e){$("#"+t.authorId+" .wrapmem table").html(t.atabtpl(e)),$(".wrapmem")[0].scrollHeight>$(".wrapmem")[0].clientHeight&&$("#"+t.authorId+" .thead .t2").addClass("t2scroll")}}),this.showModal("author")},closeAuthor:function(){},sumbitAuthor:function(){var e=this,t=$("#"+e.authorId+" tr[data-mail]"),n=[];_.each(t,function(e){var t=$(e);n.push({email:t.attr("data-mail"),chmod:t.attr("data-chmod"),rtype:t.attr("data-rtype")})});var r=JSON.stringify(n),i=$("#email2")[0].checked?1:0,s=$("#hi")[0].checked?1:0,o={source:e.source,fid:e.options.fid,sid:e.options.mid,ismail:i,ishi:s,rules:r};$.ajax({cache:!1,url:e.authorurl,data:o,type:"post",dataType:"json",success:function(t){if(t.errno){$.fn.tips(t.errmsg);return}e.hideModal("author"),$.fn.tips("共享成功！",1),e.showDocList(e.options.parentid)}})},initAuthorModal:function(){var e=this;e.modal.author=new $.fn.Modal({id:"#"+e.authorId,layid:"#lay2",closeButton:".close",okButton:"#ok",stopClickClose:!0,closeCallBack:e.closeAuthor,okCallBack:e.sumbitAuthor,events:{"click .stop":function(){e.showModal("stopshare")}},callScope:e,tpl:e.authortpl})},initModal:function(){var e=this,t=e.upModalId;e.modal.upload=new $.fn.Modal({id:t,layid:"#lay1",closeButton:".close2",okButton:".start",stopClickClose:1,data:{route:e.options.route},events:{"click .retry":e.retryuploader,"click .delfile":e.removeFile,"click .op4 input":e.selectNote},closeCallBack:e.resetUpload,okCallBack:function(t){e.startall(t)},showCallBack:function(){},callScope:e,tpl:e.uptpl}),this.initAuthorModal(),e.modal.stopshare=new $.fn.Modal({id:"#wrapstop",closeButton:".close2",okButton:"#ok2",layid:"#lean_overlay2",stopClickClose:!0,cls:"wrapdel",css:{zIndex:12e3},data:{tips:"停止共享后，文件对其它人不可见，确定停止共享？"},closeCallBack:e.closeAuthor,okCallBack:e.stopShare,callScope:e,tpl:e.stoptpl})},initDropDown:function(e){var t=this;this.drop=this.drop||{},this.drop.author=new $.fn.Dropdown({parent:"body",el:".wrapop5",id:"dropdown1",type:1,lists:[{name:"不可见",value:"000"},{name:"查看",value:"100"},{name:"查看&nbsp;下载",value:"110"},{name:"查看&nbsp;下载&nbsp;编辑",value:"111"}],leftOffset:35,topOffset:-10,tpl:'<%for(var i=0;i<lists.length;i++){%><li data-value="<%=lists[i].value%>" ><%=lists[i].name%></li><%}%>',tplSpan:'<span class="op5"><%=name%></span>',selectCallback:function(e){var t=e.attr("data-value"),n=e.html(),r=_.template(this.options.tplSpan);this.$obj.html(r({name:n,value:t})),this.$obj.parents("tr").attr("data-chmod",t)}})},checkOp1:function(){var e=this.$el.find("tr td>input:checked"),t=1,n=1,r=1,i=e.length;e.each(function(){var e=$(this).parents("tr");t=e.attr("data-down")&&t,n=e.attr("data-del")&&n,r=e.attr("data-edit")&&r});var s=this.$el.find(".op1 .down"),o=this.$el.find(".op1 .del"),u=this.$el.find(".op1 .rename");t&&i>=1?s.addClass("able"):s.removeClass("able"),n&&i==1?u.addClass("able"):u.removeClass("able"),n&&i>=1?o.addClass("able"):o.removeClass("able")},enterFname:function(e){var t=$(e.currentTarget),n=t.val();if(e.keyCode==13){e.preventDefault();if(!n){$.fn.tips("名字不能为空");return}t[0].blur()}},blurName:function(e){var t=this;setTimeout(function(){t.resetName(e)},200)},resetName:function(e){if(this.lockCancel){this.lockCancel=!1;return}var t=this,n,r=$(e.currentTarget),i=r.val(),s=r.parents("tr"),o=r.parents(".fname"),u=s.attr("data-ext"),a=s.attr("data-fid"),f=s.attr("data-mid"),l=s.attr("data-from"),c=parseInt(s.attr("data-create"));l=="2"||l=="3"||this.options.route=="ibox"?n="person":this.options.route=="team"?n="team":n="meeting",i=u?i+"."+u:i,c?$.ajax({cache:!1,url:$.urlMap.createDir,type:"POST",dataType:"json",data:{source:n,dirname:i,sid:t.options.mid,parentid:t.options.parentid},success:function(e){if(e.errno){$.fn.tips(e.errmsg);return}e=e.result,i=$("<div/>").text(i).html(),o.html(i),s.attr("data-editing",0),s.attr("data-name",i),s.attr("data-fid",e.fid),s.attr("data-create",0),window.hasInputFocus=0,t.options.route=="ibox"?Backbone.Events.trigger("UpdateTree",t.options.fid):t.options.route=="team"&&Backbone.Events.trigger("UpdateTreeTeam",t.options.fid)}}):$.ajax({cache:!1,url:$.urlMap.renameFile,type:"POST",dataType:"json",data:{fid:a,name:i,sid:f!=undefined?f:t.options.mid,source:n},success:function(e){if(e.errno){$.fn.tips(e.errmsg);return}var n=$.fn.getCurDate();s.attr("data-editing",0),o.html(i),s.find(".ctime").html(n.str),s.attr("data-name",i).attr("data-create",0),window.hasInputFocus=0,t.options.route=="ibox"?Backbone.Events.trigger("UpdateTree"):t.options.route=="team"&&Backbone.Events.trigger("UpdateTreeTeam")}})},clickop0:function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.attr("class");n.match(/down/)?this.downfile(e):n.match(/del/)?this.delfile(e,1):n.match(/edit/)&&this.goEditFile(e)},clickop1:function(e){e.stopPropagation();if(window.hasInputFocus)return;var t=$(e.currentTarget);if(!t.hasClass("able"))return;var n=t.attr("class");if(n.match(/down/))this.downfiles(e);else if(n.match(/del/))this.delfiles(e);else if(n.match(/rename/)){var r=this.$el.find("tr td>input:checked");window.hasInputFocus=1,this.editname(r)}else n.match(/newdir/)?(window.hasInputFocus=1,this.creatDir()):n.match(/addsum/)&&this.addSum()},clickop2:function(e){e.stopPropagation();if(window.hasInputFocus)return;var t=$(e.currentTarget),n=t.attr("class");this.handleOps(n,e,t)},confirmBeforeEmail:function(e,t){var n=this;n.modal.confirm5=new $.fn.Modal({id:"#wrapdel5",closeButton:".close2",okButton:".bbutton",layid:"#lean_overlay5",cls:"wrapdel",stopClickClose:1,css:{zIndex:12e3},data:{tips:"确定要发送"+(t==1?"Hi消息":"邮件")+"提醒给所有会议成员吗?"},okCallBack:function(){n.sendEmail(e,t),n.modal.confirm5.hide()},callScope:n,tpl:n.confirmtpl}),n.modal.confirm5.show()},sendEmail:function(e,t){var n=this,r=$(e.currentTarget).parents("tr"),i=r.attr("data-fid"),s=this.options,o={fid:i,sid:s.mid,source:"meeting"};t?o.ishi=1:o.ismail=1,$.ajax({url:$.urlMap.sendMsg,data:o,type:"get",success:function(e){if(e.errno){$.fn.tips(e.errmsg);return}$.fn.tips((t?"消息":"邮件")+"已发送给所有会议成员!",1)}})},creatDir:function(){var e=this,t=$.fn.getCurDate(),n=[{mid:e.options.mid,filename:"新建文件夹",realname:$.userInfos.realName||"",ctime:t.str,isdir:1,isEditing:1,isCreate:1,useCancel:1,allow_delete:1,allow_download:1,access_type:e.options.route!="ibox"||e.isShare?"1":"0"}];this.insertDocs(n),this.$el.find(".fname input").select().focus()},downfile:function(e){var t=$(e.currentTarget).parents("tr"),n=t.attr("data-fid"),r=t.attr("data-mid"),i=t.attr("data-from"),s;i=="2"||i=="3"||this.options.route=="ibox"?s="person":this.options.route=="team"?s="team":s="meeting",window.open($.urlMap.downFile+"?fid="+n+"&source="+s+"&sid="+r+"&t="+(new Date).getTime())},downfiles:function(){var e=this.getCheckedFids().join(",");e||$.fn.tips("未选中文件！"),window.open($.urlMap.downFiles+"?fids="+e+"&t="+(new Date).getTime())},goEditFile:function(e){var t=this,n=$(e.currentTarget).parents("tr"),r=n.attr("data-url");window.open(r,"_blank")},delfile:function(e,t){var n=this,r=$(e.currentTarget).parents("tr"),i=r.attr("data-fid"),s=r.attr("data-mid"),o=r.attr("data-from"),u=o=="2"||o=="3"||this.options.route=="ibox"?"person":"meeting";this.openConfirm2(i,s,function(){t?(n.modal.preview.hide(),n.showDocList(n.options.parentid)):r.remove(),n.checkOp1(),$.fn.tips("删除成功！",1),n.options.route=="ibox"?Backbone.Events.trigger("UpdateTree"):n.options.route=="team"&&Backbone.Events.trigger("UpdateTreeTeam")})},delfiles:function(){var e=this,t=this.getCheckedFids().join(",");t||$.fn.tips("未选中文件！");var n=this.$el.find("tr td>input:checked"),r=this.options.mid;this.openConfirm2(t,r,function(){n.each(function(){var e=$(this).parents("tr");e.remove()}),e.checkOp1(),$.fn.tips("删除成功！",1),e.options.route=="ibox"?Backbone.Events.trigger("UpdateTree"):e.options.route=="team"&&Backbone.Events.trigger("UpdateTreeTeam")});return},editname:function(e){if(e.length>1){$.fn.tips("不支持批量重命名");return}window.hasInputFocus=1,e.each(function(){var e=$(this),t=e.parents("tr"),n=e.parents("tr").find(".fname"),r=1,i=t.attr("data-name"),s=t.attr("data-ext");t.attr("data-name",i),t.attr("data-editing",1);var o=i.replace(/\.\w+$/,""),u=_.template('<input value="<%=name%>"/><%if(ext){%>.<%=ext%><%}%><%if(useCancel){%><span class="crename"></span><%}%>')({name:o,ext:s,useCancel:r});n.html(u),n.find("input").select().focus()})},clickCancelRename:function(e){var t=this;this.lockCancel=1,e.stopPropagation();var n=$(e.currentTarget),r=n.parents("tr"),i=r.attr("data-create")==1?1:0,s=n.parents("tr").find(".fname");r.attr("data-editing",0),i?r.remove():s.html(r.attr("data-name")),window.hasInputFocus=0,setTimeout(function(){t.lockCancel=0},300)},getCheckedFids:function(){var e=this.$el.find("tr td>input:checked"),t=[];return e.each(function(){var e=$(this).parents("tr").attr("data-fid");t.push(e)}),t},selectall:function(e){e.stopPropagation();var t=$(e.target).attr("checked"),n=!!t;this.$el.find("td>input").attr("checked",n),this.checkOp1()},selectone:function(e){var t=this;e.stopPropagation(),setTimeout(function(){t.checkOp1()},100)},selectNote:function(e){e.stopPropagation();var t=$(e.target).attr("checked"),n=!!t-0;e.target.name=="is_hi"?this.uploader.options.formData.is_himsg=n:this.uploader.options.formData.is_mail=n},clickFname:function(e){var t=this,n=$(e.currentTarget).parents("tr"),r=n.attr("data-fid"),i=n.attr("data-mid"),s=n.attr("data-name"),o=n.attr("data-edit"),u=n.attr("data-del"),a=n.attr("data-down"),f=n.attr("data-isdir"),l=n.attr("data-url"),c=parseInt(n.attr("data-editing")),h=n.attr("data-from");if(c)return;if(f){this.options.route=="ibox"?this.goIboxPage({fid:h!="share"?r:"share"+r}):this.options.route=="team"?this.goTeamPage({fid:r}):this.showDocList(r);return}if(this.options.route=="team")return;t.modal=t.modal||{},t.modal.preview=new $.fn.Modal({id:"#wrappreview",closeButton:".close",okButton:".start",cls:"wrappreview",stopClickClose:1,data:{name:s,fid:r,mid:i,edit:o,editurl:l,del:u,down:a},events:{"click .op0 span":t.clickop0,"click .ophead":function(){var e=$("#wrappreview .op0").height(),t=28;e==t?$("#wrappreview .op0").height("auto"):$("#wrappreview .op0").height(t)}},okCallBack:t.startall,callScope:t,closeCallBack:function(){t.modal.preview.remove()},tpl:t.previewtpl,createCallBack:function(){var e=532,t=1e3,n=$("<iframe/>").on("load",function(e){}).attr({src:$.urlMap.preview+"?fid="+r+"&width="+t+"&height="+e,frameborder:0}).css({height:e});$("#wrappreview").append(n)}}),t.modal.preview.show()},showModal:function(e){this.modal[e].show();return},hideModal:function(e){this.modal[e].hide();return}});return f}),define("text!views/iboxdocs/share.tpl",[],function(){return'<div class="nav"><span class="tit">转发到Hi群</span><span class="close close6"></span></div>\n<div class="wraptree">\n<div class="left">\n    <div class="search"><input class="searchtree" type="text" placeholder="输入搜索关键词"/></div>\n    <div class="treehi" id="treehi">\n        <div id="group"></div>\n        <div id="topic"></div>\n    </div>\n</div>\n<div class="right">\n    <div class="head">转发给Hi群</div>\n    <div class="slists">\n        <ul>\n        </ul>\n\n    </div>\n    <div class="tiphi">最多只能分享给5个群组</div>\n    <div class="doctit"><span class="icon docx "></span>asdfsdf.doc</div>\n</div>\n</div>\n<div class="wrapbutton">\n    <span class="cancel close6">取消</span>\n    <span id="ok4" class="bbutton"> 确定</span>\n\n</div>\n'}),define("text!views/iboxdocs/ibox.css",[],function(){return"#iboxlist .detailtab th.t3{width:195px;}#iboxlist .wrapdoclist{position:relative;}#iboxlist .fname{height:30px;line-height:30px;border:2px dotted transparent;}#iboxlist .dragstart{border-color:#63a2ef;}#iboxlist .top1{top:40px;}#iboxlist .top0{top:0;}#iboxlist .dirs{}#iboxlist .jsdropdown-lists{max-height:inherit;}#wrapiboxauthor{height:450px;overflow-x:hidden;overflow-y:hidden;}#wrapiboxauthor .wrapmem{height:230px;}.jsdropdown-lists .linfo{line-height:19px;padding:6px 10px;}.haslist .wtable{overflow-x:hidden;overflow-y:auto;height:0;}.haslist .head{padding-left:20px;position:relative;height:25px;line-height:25px;border-bottom:none;font-size:13px;color:#666;}.haslist .fold{position:absolute;right:13px;top:0px;width:25px;height:25px;background:url(common/imgs/result.png) 5px -455px no-repeat transparent;}.unfold .fold{background-position:5px -488px;}.jsdropdown-lists li{position:relative;}.jsdropdown-list .status{position:absolute;right:0;top:0;width:50px;line-height:50px;height:50px;padding:0 5px;background:url(common/imgs/result.png) -78px -512px no-repeat transparent;}.jsdropdown-item-on .status,.jsdropdown-item-cur .status{background-position:-78px -550px;}.wraptree .left{width:250px;position:absolute;left:0px;bottom:30px;top:40px;border-right:1px solid #e7ecf1;}.searchtree{height:28px;line-height:28px;border:1px solid #d3d3d3;padding-left:34px;outline:none;width:173px;margin-left:20px;background:url(common/imgs/result.png) -103px -821px no-repeat transparent;}.left .treehi{width:auto !important;overflow-x:hidden;overflow-y:auto;height:340px;font-size:13px;}.treehi .jstree-item > .jstree-witem > .jstree-icon{display:none;}.treehi .jstree-open > .jstree-witem > .jstree-icon{display:inline-block;background:url(common/imgs/fold1.png) no-repeat -30px center transparent;}.treehi .jstree-close > .jstree-witem > .jstree-icon{display:inline-block;background:url(common/imgs/fold1.png) no-repeat 0px center transparent;}.treehi ul,.treehi li{position:relative;}.treehi > ul{margin-left:0px;}.treehi .depth1 .jstree-witem{padding-left:20px;}.treehi .depth2 .jstree-witem{padding-left:40px;}.treehi .depth1 .jstree-anchor{width:136px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:25px;height:25px;}.treehi .depth1 > ul{overflow-x:hidden;overflow-y:auto;margin-right:5px;}.treehi .depth1 > ul::-webkit-scrollbar{width:6px;height:10px;}.treehi .depth1 > ul::-webkit-scrollbar-button{background-color:transparent;}.treehi .depth1 > ul::-webkit-scrollbar-track{background:transparent;}.treehi .depth1 > ul::-webkit-scrollbar-track-piece{display:none;}.treehi .depth1 > ul::-webkit-scrollbar-thumb{background:#dce3eb;width:6px;}.treehi ul{margin-left:0px;}.treehi ul .jstree-item-on{background-color:#f5f5f5;color:#b3b3b3;}.wraptree .right{position:relative;margin-left:252px;}.right .head{padding-left:20px;line-height:20px;border-bottom:0;background-color:transparent;}.right .slists{padding-left:20px;height:199px;line-height:25px;color:#999;overflow-x:hidden;overflow-y:hidden;}.slists li{position:relative;margin:12px 0;}.slists li span{display:inline-block;vertical-align:middle;}.slists li .text{max-width:180px;height:27px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;}.slists img,.treehi img{width:25px;height:25px;border-radius:12px;vertical-align:middle;margin-right:8px;}.slists .del{width:25px;height:25px;position:relative;display:inline-block;vertical-align:middle;background:url(common/imgs/result.png) 4px -129px no-repeat;margin-left:10px;cursor:pointer;}.right .tiphi{color:#feab82;line-height:34px;border-bottom:1px solid #e7ecf1;text-align:center;}.right .doctit{padding:16px 0 0 20px;vertical-align:middle;}.doctit .icon{margin-right:13px;}.wrapbutton{position:absolute;bottom:22px;right:22px;}.wrapbutton span{display:inline-block;height:28px;line-height:28px;width:80px;}.wrapbutton .cancel{width:auto;margin-right:16px;cursor:pointer;}.bbutton:hover{background-color:#5196ea;}#iboxlist .wrap-no10{position:relative;left:3px;z-index:100;background:white;}#wrapupshare .jstree-item-active > .jstree-whole{height:36px;color:#b3b3b3;}#wrapupibox .wrapnews{display:none;}.limitSize{width:100px;overflow:hidden;height:28px;}#wrapupshare{height:450px;}#iboxlist .m404{top:150px;}"}),define("views/iboxdocs/iboxdocs",["views/doclist/doclist","text!views/iboxdocs/share.tpl","text!views/iboxdocs/ibox.css"],function(e,t,n){var r=e.prototype.events,i=e.extend({dirtpl:_.template('<%if(fromShare){%><span class="all share dirs" data-id="share" >来自共享</span><%}else{%><span class="all dirs" >我的文件</span><%}%><%for(var i =0,l=tree.length;i<l;i++){%>&gt;<span class="<%if(i!=l-1){%>dirs<%}%>" data-id="<%if(fromShare){%>share<%}%><%=tree[i].fid%>"><%=tree[i].filename%></span><%}%>'),shareTree:'<span class="jstree-whole"></span><div class="jstree-witem "><i class="jstree-icon "></i><div class="jstree-wname" ><%if(!this.isInput){%><%if(this.treepic){%><img src="<%this.treepic%>" alt=""/><%}%><span class="jstree-anchor" data-fid="<%this.treeid%>" data-stype="<%this.stype%>" data-img="<%this.treepic%>"  draggable="true"><%this.text%></span><%}else{%><input class="jstree-input"  type="text" value="<%this.text%>"/><span class="jstree-cancel"></span><%}%></div></div>',sharetpl:_.template(t),events:$.extend({"mousedown .fname ":"evtDragstart","mouseenter .fname":"evtDragover","mouseleave .fname ":"evtDragout"},r),dataAuthor:{},popParent:".listLeft2",stopshareurl:$.urlMap.iboxStopShare,authorurl:$.urlMap.setIboxRule,pasteId:"#pastewrapibox",upModalId:"#wrapupibox",initDragFile:function(){var e=this;this.$dragText=$("<div />").addClass("drag-icon drag-iconibox").appendTo("body").hide(),$("body").on("mousemove",function(t){e.evtDrag(t)}).on("mouseup",function(t){e.evtDrop(t)})},initExtend:function(){var e=this;this.selectPerson=0,this.selectPersonMap={},this.authorId="wrapiboxauthor",this.bindResize(),this.insertCss(n),this.createDragModal(),this.initDragFile(),Backbone.Events.on("selectuser",function(){var t=[].slice.apply(arguments)[0],n;if(e.selectPerson>=5){$.fn.tips("最多只能分享给5个群组！");return}if(e.selectPersonMap[t.id]){$.fn.tips("已添加！");return}e.selectPerson++,e.selectPersonMap[t.id]=1,n=_.template('<li data-id="<%=id%>" data-stype="<%=stype%>"><%if(imgurl){%><img src="<%=imgurl%>" alt=""><%}%><span class="text"><%=value%></span><span class="del"></span></li>'),$("#wrapupshare .slists ul").append(n(t)),$("#wrapupshare .head").html("转发给Hi群（"+e.selectPerson+"/5）")}),Backbone.Events.on("showShare",function(t){var n;e.showModal("share"),n=_.template('<span class="icon <%=type%> "></span><%=name%>'),$("#wrapupshare .doctit").html(n(t)).attr("data-fid",t.fid)}),Backbone.Events.on("movesuccess",function(t){var n=t.fid,r;r=e.$el.find("#f"+n),r.length&&r.remove()})},bindResize:function(){var e=this;$("body").on("mousedown",function(t){t.stopPropagation();var n=$(t.target);n.hasClass("resize")&&(e.resizeObj=n,e.resizeMouseDown=1,n.addClass("resizeon"))}).on("mousemove",function(t){t.stopPropagation();if(!e.resizeMouseDown)return;Backbone.Events.trigger("dragleft",t.clientX)}).on("mouseup",function(t){t.stopPropagation();if(!e.resizeMouseDown)return;e.resizeMouseDown=0,e.resizeObj.removeClass("resizeon")})},display:function(e){var t=this,n;e.fid=e.fid||"0",t.options.parentid=e.fid,n=t.template(e),t.$el.html(n).hide(),t.$el.show(),t.$paste=t.$el.find(t.pasteId),t.getFromShare(e.fid),t.initModal(),t.initDropDown(),t.initUploader(),t.showDocList(e.fid),t.initModalShare(),t.initDrag()},getFromShare:function(e){var t="person",n="share";/^\d+$/.test(e)?(this.fromShare=0,this.$el.removeClass(n).addClass(t)):(this.fromShare=1,this.$el.removeClass(t).addClass(n));return},showDocList:function(e){var t=this,n=$.urlMap.iboxList,r=this.options,i={},s=this.fromShare;window.hasInputFocus=0,this.fromShare?(e=e.replace("share",""),/^\d+$/.test(e)?i={fid:e}:i={uname:e},n=$.urlMap.userList,s=1,t.$el.find(".op1").addClass("limitSize")):(e!=0&&(i.fid=e),t.$el.find(".op1").removeClass("limitSize")),$.ajax({url:n,data:i,cache:!1,dataType:"json",success:function(e){switch(e.errno){case 20009:case 30002:t.$el.html($('<div class="m403"></div>'));break;case 20001:t.$el.html($('<div class="m403"></div>'))}if(e.errno)return;var n,i,o,u,a;e=e.result,i=e.fileInfor||{},o=i.access_type,t.isShare=o==1?1:0,n=$.extend({},r),n.tree=e.tree,n.docs=e.docs,n.isSearch=0,n.showWrap=1,n.showLoad=1,n.fromShare=s,t.mData=e.docs.length?1:0,t.mDir=0,u=t.detailstpl({data:n}),t.$el.find(".doclistinner").html(u),a=t.dirtpl(n),t.$el.find(".op8").html(a),t.initRightDropDown(),!e.docs.length&&t.fromShare?t.$el.find(".wrapop1").hide():t.$el.find(".wrapop1").show()}})},getDir:function(e){var t=$(e.currentTarget).attr("data-id")||0;Backbone.Events.trigger("UpdateCur",t);if(!t){Backbone.history.navigate("#ibox/0",{trigger:!0});return}this.goIboxPage({fid:t})},createDragModal:function(){this.dndImage=new Image,this.dndImage.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",this.$dragText=$("<div />").addClass("drag-icon").appendTo("body").hide()},evtDragstart:function(e){var t=$(e.target),n,r,i;e=e.originalEvent;if(e.target.tagName=="INPUT")return;e.preventDefault(),n=$.ldom.getParentByTag(e.target,"tr"),r=n.getAttribute("data-fid"),i=t.attr("draggable");if(!i)return;this.tips=$(e.target).html(),this.dragId=r,this.$dragobj=t,this.startX=e.clientX,this.startY=e.clientY,this.isClick=1},evtDrag:function(e){var t,n;e=e.originalEvent,t=Math.abs(e.clientX-this.startX),n=Math.abs(e.clientY-this.startY);if(!this.isClick)return;if(!(t>10||n>10))return;this.isMoving=1,Backbone.Events.trigger("dragfile",this.dragId),e.clientX==0?this.$dragText.hide():(this.$dragobj.addClass("dragstart"),this.$dragText.css({left:e.clientX+10,top:e.clientY+10,zIndex:1e3}),this.$dragText.html(this.tips).show())},evtDragover:function(e){if(!this.isMoving)return;var t=$(e.target),n,r;n=$($.ldom.getParentByTag(e.target,"tr")),r=n.attr("data-isdir");if(!r){t.css("cursor","no-drop");return}t.css("cursor","pointer"),$(e.target).addClass("dragstart")},evtDragout:function(e){$(e.target).removeClass("dragstart"),$(e.target).css("cursor","pointer")},evtDrop:function(e){var t,n=$(e.target),r,i,s,o;s=$.ldom.getParentByTag(e.target,"tr"),o=$(s).attr("data-isdir"),e=e.originalEvent,this.isClick=0;if(!this.isMoving)return;this.isMoving=0,this.$dragText.hide(),this.$dragobj.removeClass("dragstart"),n.removeClass("dragenter"),r=this.dragId;if(!r||!o)return;if(!n.hasClass("fname")){Backbone.Events.trigger("dragfileend");return}Backbone.Events.trigger("dragfileend"),$(e.target).removeClass("dragstart"),i=s.getAttribute("data-fid"),$.ajax({data:{dest_fid:i,source_fids:r},url:$.urlMap.moveurl,type:"get",dataType:"json",success:function(e){if(e.errno){$.fn.tips(e.errmsg);return}Backbone.Events.trigger("movesuccess",{did:i,fid:r}),$.fn.tips("移动成功",1)}})},shareDoc:function(e){var t=e.parents("tr"),n,r,i;n=t.attr("data-name"),r=t.attr("data-fid"),i=t.attr("data-ext"),Backbone.Events.trigger("showShare",{name:n,fid:r,type:i==""?"dir":i})},initModalShare:function(){var e=this;if(this.hasInitModalShare)return;this.hasInitModalShare=!0,e.modal.share=new $.fn.Modal({id:"#wrapupshare",layid:"#lay5",closeButton:".close6",okButton:"#ok4",stopClickClose:1,events:{"click .del":e.removePerson,"input .searchtree":e.searchHi},getData:function(){var e=$.Deferred();return $.get($.urlMap.hiGroup,{_:(new Date).getTime()},function(t){if(parseInt(t.errno))return;e.resolve(t.result)}),e.promise()},closeCallBack:function(){e.resetPerson()},okCallBack:function(t){e.sumbitShare()},showCallBack:function(){e.initHitree()},callScope:e,tpl:e.sharetpl})},searchHi:function(e){var t=e.currentTarget.value,n=t==""?$.urlMap.hiGroup:$.urlMap.searchTree,r={kw:t,_:(new Date).getTime()};this.tree.updateTree({url:$.urlMap.searchTree,getData:function(){var e=$.Deferred();return $.get(n,r,function(t){if(parseInt(t.errno))return;e.resolve(t.result.groups)}),e.promise()}})},initHitree:function(){var e=this;if(this.initTreeData)return;this.initTreeData=1,this.tree=$.BaseTree2.getExample({parentId:"treehi",getData:function(e){var t=$.Deferred();return $.get($.urlMap.hiGroup,{_:(new Date).getTime()},function(e){if(parseInt(e.errno))return;t.resolve(e.result)}),t.promise()},litpl:e.shareTree,alias:function(e){var t={id:"treeid",text:"treename",hasChild:"haschild",child:"childs"};return t[e]||e},depth:1,open:!0,plugins:[],callbacks:{onClick:function(e){var t,n,r,i=e.target.getAttribute("data-fid")-0;t=e.target.innerHTML,n=e.target.getAttribute("data-stype"),r=e.target.getAttribute("data-img");if(!i)return;Backbone.Events.trigger("selectuser",{id:i,value:t,stype:n,imgurl:r})}}})},removePerson:function(e){var t=$.ldom.getParentByTag(e.currentTarget,"li"),n;n=t.getAttribute("data-id"),t.parentNode.removeChild(t),delete this.selectPersonMap[n],this.selectPerson--,$("#wrapupshare .head").html("转发给Hi群（"+this.selectPerson+"/5）")},resetPerson:function(){var e=this;e.selectPerson=0,e.selectPersonMap={},$("#wrapupshare .head").html("转发给Hi群"),$("#wrapupshare .slists ul").html("")},sumbitShare:function(){var e,t,n,r=[],i=this;e=$("#wrapupshare .doctit"),t=$("#wrapupshare .slists li"),t.each(function(e,t){var n={gid:t.getAttribute("data-id"),stype:t.getAttribute("data-stype")};r.push(n)});if(!r.length){$.fn.tips("请至少选中一项");return}n={fid:e.attr("data-fid"),source:"person",shares:JSON.stringify(r)},$.ajax({url:$.urlMap.shareDoc,type:"post",data:n,dataType:"json",success:function(e){if(e.errno)return;i.hideModal("share"),$.fn.tips("转发成功",1)}})},initAuthorModal:function(){var e=this;e.modal.author=new $.fn.Modal({id:"#"+e.authorId,layid:"#lay2",closeButton:".close",okButton:"#ok",stopClickClose:!0,closeCallBack:e.closeAuthor,okCallBack:e.sumbitAuthor,events:{"click .stop":function(){e.showModal("stopshare")},"click .head":function(){e.toggleAuthor()}},callScope:e,tpl:e.authortpl,showCallBack:function(){e.initAuthorContext(),e.modal.author.$parent.find(".wrapmem tr").remove()}}),this.showAuthorList=0},openAuthor:function(e){var t=this;e=e||{},e.stopPropagation&&e.stopPropagation();var n=$(e.currentTarget).parents("tr"),r=n.attr("data-fid");this.options.fid=r,t.getSharedList(r),this.showModal("author")},getSharedList:function(e){var t=this;$.ajax({url:$.urlMap.shareList,cache:!1,type:"post",dataType:"json",data:{fid:e},success:function(e){$(".haslist table").html(t.atabtpl(e))}})},toggleAuthor:function(){this.showAuthorList?this.hideAuthor():this.showAuthor()},hideAuthor:function(){if(this.showAuthorList===0)return;this.showAuthorList=0,$(".haslist").removeClass("unfold"),$(".haslist .wtable").animate({height:"0"}),$(".wrapmem").animate({height:"230px"})},showAuthor:function(){if(this.showAuthorList===1)return;this.showAuthorList=1,$(".haslist").addClass("unfold"),$(".haslist .wtable").animate({height:"230px"}),$(".wrapmem").animate({height:"0"})},initAuthorContext:function(){var e=this;e.dataAuthor={},e.initSearchDropDown()},initSearchDropDown:function(){var e=this;if(this.hasInitSearch)return;this.hasInitSearch=1,$.InputDropDown.getExample({el:".sauthor",$tpl:"",parent:"body",css:{width:509,height:150,maxHeight:150},leftOffset:-13,topOffset:1,tpl:'<%for(var i=0;i<this.lists.length;i++){ list=this.lists[i];%><li class="linfo <%if(list.hasShow){%>added<%}%>" data-value="<%list.key%>" data-depart="<%list.departmentName%>" data-name="<%list.truename%>" data-rtype="<%list.type%>" ><%list.truename%>(<%list.departmentName%>)<div><%list.key%>@baidu.com</div><span class="status"><%if(list.hasShow){%>已共享<%}%></span></li><%}%>',getData:function(e){var t=this,n=$(e.target),r,i=$.Deferred();return r=n.val(),$.ajax({url:$.urlMap.searchUser,cache:!1,type:"get",dataType:"json",data:{kw:r,filter:"noself"},success:function(e){e=e.result,t.lists=e,i.resolve()}}),i.promise()},tplSpan:'<span class="op5"><%=name%></span>',delCallback:function(e){},enterCallback:function(e){},selectCallback:function(t){var n=t.attr("data-value"),r,i=t.attr("data-name"),s=t.attr("data-rtype"),o=t.attr("data-depart");if(e.dataAuthor[n]){$.fn.tips("已添加该人!");return}e.dataAuthor[n]=1,r=e.atabtpl({result:[{email:n+"@baidu.com",name:n,realname:i,depart:o,rtype:s,isview:1,isdownload:1,isedit:0,chmod:"110",isadmin:!1}]}),e.hideAuthor(),$("#"+e.authorId+" .wrapmem  table").append(r),this.$el.val(""),this.hide()}})},destory:function(){this.$el.html("").hide()}});return i});