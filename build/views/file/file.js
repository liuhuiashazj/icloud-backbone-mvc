define("text!views/file/file.tpl",[],function(){return'<div class="crumbs">\n    <%if(data.source==\'meeting\'){%>\n    <span class="gomain">会议</span>&gt;<span class="gomeet"><%=data.infor.meet%></span>&gt;<span><%=data.infor.file_name%>.<%=data.infor.file_ext%></span>\n    <%}else{%>\n    <span class="<%if(data.source==\'share\'){%>gomeet<%}else{%>gomain<%}%>" data-fid="<%if(data.source==\'share\'){%>share<%}%>"><%if(data.source==\'share\'){%>共享<%}else{%>个人<%}%></span><%var tree=data.tree||[];for(var i=0,l=tree.length;i<l;i++){var da=tree[i]%>&gt;<span <%if(i<l-1){%> class="gomeet" data-fid="<%if(data.source==\'share\'&&i!=0){%>share<%}%><%=da.fid%> <%}%>"><%=da.filename%></span><%}%>\n    <%}%>\n\n</div>\n<div class="filedetail">\n\n    <div class="op8">\n\n        <%if(data.infor.isdownload){%><span class="down able">下载</span><%}%><%if(data.infor.allow_edit){%><span\n            class="edit able" data-url="<%=data.infor.editurl%>">编辑</span><%}%><%if(data.infor.isdelete){%><span\n            class="del able">删除</span><%}%>\n    </div>\n    <div class="title"><div class="fname" data-name="<%=data.infor.file_name%>.<%=data.infor.file_ext%>" data-ext="<%=data.infor.file_ext%>"><%=data.infor.file_name%>.<%=data.infor.file_ext%></div><%if(data.infor.isdelete){%><span class="editname"></span><%}%></div>\n    <div class="infos">最后一次编辑于：<%=data.infor.editor%> <%=data.infor.update_time%></div>\n\n\n    <div class="view">\n        <iframe src="/v1/disk/preview?fid=<%=data.infor.f_id%>&width=<%=data.infor.width%>&height=<%=data.infor.height%>" frameborder="0" width="<%=data.infor.width%>" height="<%=data.infor.height%>"></iframe>\n    </div>\n</div>'}),define("text!views/file/file.css",[],function(){return"#file .crumbs{margin:0 20px;}.crumbs .gomain{padding-left:0;}.gomain,.gomeet{color:#2c80e7;cursor:pointer;}.filedetail{position:relative;overflow:auto;font-size:13px;}#file .op8{position:absolute;right:10px;top:15px;background:none;}#file .op8 span{display:inline-block;line-height:26px;height:26px;overflow:hidden;border:1px solid #c2c2c2;color:#666;width:78px;margin-right:10px;text-align:center;cursor:pointer;vertical-align:top;}.filedetail .title{font-size:18px;line-height:30px;margin:6px 0 6px 20px;}.filedetail .fname input{}.filedetail .fname{display:inline-block;vertical-align:top;height:30px;}.filedetail .crename{height:29px;}.filedetail .editname{display:inline-block;width:30px;height:30px;background:url(common/imgs/result.png) -54px -599px no-repeat transparent;vertical-align:top;cursor:pointer;}.filedetail .editname:hover{background-position:-54px -642px;}.infos{color:#666;line-height:13px;margin-bottom:15px;margin-left:20px;}#file .crumbs{line-height:43px;background-position:0 42px;}#file .crumbs span:first-child{padding-left:0;}"}),define("views/file/file",["text!views/file/file.tpl","text!views/file/file.css"],function(e,t){var n=Backbone.BaseView.extend({el:"#file",tpl:_.template(e),cssText:t,tpl403:_.template('<div class="inner">如有问题请联系<%if(data.isIbox){%>文件所有者<%}else{%>会议负责人<%}%>：<span><%=data.name%></span><%if(data.hi){%><span>Hi: <a href="baidu://message/?id=<%=data.hi%>"><%=data.hi%></a></span><%}%><span>E-mail: <a href="mailto:<%=data.email%>"><%=data.email%></a></span></div>'),events:$.extend({"click .op8 span":"clickop8","click .editname":"editname","keydown .fname input":"enterFname","blur .fname input":"blurName","click .crename":"clickCancelRename","click .gomain":"goMainPage","click .gomeet":"goMeet"},Backbone.BaseView.baseEvents),init:function(){var e=this;$(window).on("resize",function(){e.isShow&&e.reRender()})},reRender:function(){var e=this;e.insertData(e.lastData)},destory:function(){this.isShow=0},display:function(e){var t=this,n=e.fid,r;this.isShow=1,this.options=e,/^\d+$/.test(n)?(this.isIbox=0,r=$.urlMap.fileInfo):(this.isIbox=1,n=n.replace("ibox",""),this.options.fid=n,r=$.urlMap.iboxfileInfo),$.ajax({url:r,data:{fid:n,source:t.isIbox?"person":"meeting"},dataType:"json",type:"get",success:function(e){var n=t.isIbox?$.urlMap.iboxfileInfo:$.urlMap.meetInfo;switch(e.errno){case 20009:case 30008:$.ajax({url:n,dataType:"json",type:"GET",cache:!1,data:{fid:t.options.fid,isnotify:t.isIbox?1:0},success:function(e){if(e.errno)return;e=e.result,e.isIbox=t.isIbox;var n=$('<div class="m404 f404"></div>').html(t.tpl403({data:e}));t.$el.html(n)}});return;case 30002:t.$el.html($('<div class="m403 f403"></div>'));return}t.lastData=e.result,t.insertData(e.result)}})},insertData:function(e){var t=this.$el.width()-0,n=window.innerHeight-175,r=window.innerHeight-180,i;this.options.mid=e.meetingInfor.mid,e.infor.width=t,e.infor.height=n,e.infor.meet=e.meetingInfor.title,e.infor.mid=e.meetingInfor.mid,e.isIbox=this.isIbox,i=this.tpl({data:e}),this.$el.html(i)},clickop8:function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.attr("class");n.match(/down/)?this.downfile(e):n.match(/del/)?this.delfile(e):n.match(/edit/)?this.goEditFile(t):n.match(/rename/)},downfile:function(e){var t=this.options.fid,n=this.options.mid||0,r=this.isIbox?"":"meeting";window.open($.urlMap.downFile+"?fid="+t+"&source="+r+"&sid="+n+"&t="+(new Date).getTime())},goEditFile:function(e){var t=e.attr("data-url");window.open(t,"_blank")},delfile:function(e,t){var n=this,r=this.options.fid,i=this.options.mid||0;this.openConfirm2(r,i,function(){$.fn.tips("删除成功！",1),n.goMainPage()})},goMeet:function(e){if(this.isIbox){var t=$(e.target).attr("data-fid");Backbone.Events.trigger("UpdateTree",t),this.goIboxPage({fid:t});return}var n={route:"detailm",detail:"all",page:this.options.mid};this.goDetailPage(n)},editname:function(e){this.$el.find(".editname").hide();var t=this.$el.find(".fname"),n=1,r=t.attr("data-name"),i=t.attr("data-ext");t.attr("data-editing",1);var s=r.replace(/\.\w+$/,""),o=_.template('<input value="<%=name%>"/><%if(ext){%>.<%=ext%><%}%><%if(useCancel){%><span class="crename"></span><%}%>')({name:s,ext:i,useCancel:n});t.html(o),t.find("input").select().focus()},clickCancelRename:function(e){this.lockCancel=1,e.stopPropagation();var t=$(e.currentTarget),n=t.parents(".fname");n.attr("data-editing",0),n.html(n.attr("data-name")),this.$el.find(".editname").show()},enterFname:function(e){var t=$(e.currentTarget),n=t.val();if(e.keyCode==13){e.preventDefault();if(!n){$.fn.tips("名字不能为空");return}t[0].blur()}},blurName:function(e){var t=this;setTimeout(function(){t.resetName(e)},200)},resetName:function(e){if(this.lockCancel){this.lockCancel=!1;return}var t=this,n=$(e.currentTarget),r=n.val(),i=n.parents(".fname"),s=i.attr("data-ext");r=s?r+"."+s:r,$.ajax({cache:!1,url:$.urlMap.renameFile,type:"POST",dataType:"json",data:{fid:t.options.fid,name:r,sid:t.options.mid,source:t.isIbox?"":"meeting"},success:function(e){if(e.errno){$.fn.tips(e.errmsg);return}i.attr("data-editing",0),i.html(r),i.attr("data-name",r),t.$el.find(".editname").show(),$.fn.tips("修改成功！",1)}})}});return n});