define("text!views/items/items.css",[],function(){return"#items .crumbs{margin-left:0;}.nav{height:43px;line-height:43px;padding-left:20px;position:relative;font-size:14px;}.nav .status{font-weight:normal;display:inline-block;margin-left:6px;}.status .on{color:#2c80e7;}.status li{display:inline-block;}.status input{margin:0 5px 0 15px;cursor:pointer;}.page{position:absolute;right:10px;top:0;line-height:43px;}"}),define("views/items/itemsModel",[],function(){var e=Backbone.Model.extend({idAttribute:"mid",parse:function(e){return e.page=this.collection.currentPage,e.id=e.mid-0,e}});return e}),define("views/items/itemsCollection",["views/items/itemsModel"],function(e){var t=Backbone.Collection.extend({model:e,url:$.urlMap.meetList,initialize:function(e){var t=this;this.hasMore=1,this.bind("remove",function(){--t.totalPn},this),e.onRemove&&this.bind("remove",e.onRemove,this)},parse:function(e){if(!e.errno){var t=e.result,n=t.meetings.length;return this.totalPn=parseInt(t.total),this.hasMore=n<this.totalPn?1:0,this.currentPage=parseInt(t.page),t.meetings}},range:function(e,t){var n=e;return this.slice(n,n+t)},getData:function(e){var t=this,n=e.rn,r=e.callback,i,s;this.fetchServer(e)},fetchServer:function(e){var t=this,n,r=e.callback;this.currentPage=e.page,this.rn=e.rn,this.fetch({cache:!1,data:{pageSize:e.pageSize,page:e.page,role:e.role,product:e.product,sort:e.sort,classify:e.classify,by:e.by},success:function(){t.totalPn==t.length&&(t.hasMore=0);var n=t.where({page:parseInt(e.page)});r&&r.call(t,n)},error:function(){},dataType:"json",remove:!1,add:!0,merge:!0})}});return t}),define("views/items/items",["text!views/items/items.css","views/items/itemsCollection","text!common/tpl/meeting.tpl"],function(e,t,n,r){var i=Backbone.BaseView.extend({el:"#items",cssText:e,events:$.extend({"click .detail":"goDetail","click .delmeet":"delMeet","click .status":"goStatus","click .by":"sortBy"},Backbone.BaseView.baseEvents),listtpl:_.template(n),pagetpl:_.template("已加载<%=data.index%>/全部<%=data.totalPn%>"),drop:{},rn:20,options:{},init:function(){var e=this;this.collection=new t({onRemove:function(t,n,r){var i=e.pagetpl({data:{index:n.length,totalPn:n.totalPn}});e.$el.find(".page").html(i),e.$el.find("table .total").html("("+n.totalPn+")"),r.obj.remove(),$.fn.tips("删除成功！",1)}}),this.initSort(),this.parentEl=this.$el.parents(".lists")[0]},isLast:function(e){for(var t in e){var n=this.options;if(e[t]!=n[t])return!1}return!0},display:function(e){e=$.extend({},e);var t=e.page||1;if(this.isLast(e)&&!window.updateItem&&e.route!="search"){this.$el.show(),this.parentEl.scrollTop=this.lastTop;return}window.updateItem=!1,this.options=e,this.currentPage=parseInt(t),this.$el.show(),this.reset(),e.route=="search"?this.showSearchList():this.showMeetList()},loadMore:function(){var e=this;if(!this.hasMore)return;this.currentPage++,this.options.route=="search"?this.showSearchList(1):this.showMeetList(1)},destory:function(){this.$el.hide()},goDetail:function(e){var t=$(e.currentTarget).attr("data-mid");if(!t)return;var n=$.extend({},this.options),r=n.route;n.route=r=="product"?"detailp":"detailm",n.detail=r=="product"?n.product:n.role,n.page=t,this.lastTop=this.parentEl.scrollTop,this.goDetailPage(n)},sortBy:function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.attr("data-by"),r=n=="asc"?"desc":"asc";this.options.by=r,t.removeClass(n).addClass(r).attr("data-by",r),this.reset(),this.showMeetList(2)},initSort:function(){var e=this;this.drop.sort=new $.fn.Dropdown({parent:"#items",el:".sort",id:"dropdown5",type:1,lists:[{name:"会议开始时间",value:"stime"},{name:"会议创建时间",value:"ctime"}],css:{width:150},leftOffset:0,topOffset:0,tpl:'<%for(var i=0;i<lists.length;i++){%><li data-value="<%=lists[i].value%>" ><%=lists[i].name%></li><%}%>',tplSpan:'<span class="op5"><%=name%></span>',selectCallback:function(t){var n=t.attr("data-value");e.options.sort=n,e.reset(),e.showMeetList(2)}})},reset:function(){this.currentPage=1,this.collection.reset()},goStatus:function(e){var t=this,n=$(e.target),r=n.attr("data-classify");n.parents(".status").find("li").removeClass(),n.parents("li").addClass("on");if(r==undefined)return;t.options.classify=r,t.reset(),t.showMeetList(2)},showMeetList:function(e){if(this.isLoading)return;this.isLoading=1;var t=this,n=this.options,r=n.role==="all"?"":n.role,i=n.product==="all"?"":n.product,s=n.sort||"ctime",o=n.by||"desc",u=this.currentPage,a=n.classify||"";this.collection.getData({role:r,product:i,page:u,pageSize:t.rn,sort:s,by:o,classify:a,callback:function(r){t.isLoading=0,r=_.pluck(r,"attributes");var i=$.extend({},t.options);i.data=r,i.pn=u,i.meeting=$.allConfig.mapMeeting[n.role],i.index=this.length,i.totalPn=this.totalPn,i.showWrap=1,i.hasMore=this.hasMore,t.hasMore=this.hasMore,i.sort=s,i.by=o,i.classify=a;var f,l=t.pagetpl({data:i});if(!e)f=t.listtpl({data:i}),t.$el.html(f),t.$el.find(".page").html(l),!this.hasMore&&t.showNoMore(1);else if(e==1)i.showWrap=0,f=t.listtpl({data:i}),t.$el.find("table tbody").append(f),t.$el.find(".page").html(l),!this.hasMore&&t.showNoMore(0);else{i.showWrap=0,i.hideNo=1,f=t.listtpl({data:i}),t.$el.find("table .detail").remove(),t.$el.find("table tbody").append(f),t.$el.find(".page").html(l),t.$el.find("table .total").html("("+i.totalPn+")");if(this.hasMore){var c=t.$el.find("#listwrap .loading");c.length==0&&(c=$('<div class="loading" ></div>'),t.$el.find("#listwrap").append(c)),c.removeClass("nomore").html("").show()}else t.showNoMore(1)}}})},delMeet:function(e,t){var n=this,r;e.stopPropagation(),t||(r=$(e.currentTarget).parents("tr"),t=r.attr("data-mid")),this.openConfirm1(t,function(){n.collection.remove(n.collection.get(t),{obj:r})});return},showSearchList:function(e){var t=this.options,n=this;$.ajax({cache:!1,url:$.urlMap.searchMeet,dataType:"json",type:"GET",data:{kw:t.word,page:n.currentPage,pageSize:n.rn},success:function(t){if(t.errno)return;t=t.result;var r={};n.hasMore=t.has_more,r.hasMore=n.hasMore,r.isSearch=1,r.pn=n.currentPage,r.data=t.meetings;if(!e){r.showWrap=1;var i=n.listtpl({data:r});n.$el.html(i),!n.hasMore&&n.showNoMore(1)}else{r.showWrap=0;var s=n.listtpl({data:r});n.$el.find("table tbody").append(s),!n.hasMore&&n.showNoMore(0)}}})}});return i});